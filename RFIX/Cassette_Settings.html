<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Å—Å–µ—Ç—ã - –ù–∞—Å—Ç—Ä–æ–π–∫–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            background: #f5f5f5;
            color: #333;
            padding: 10px;
        }
        .section {
            background: white;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .params-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        .param-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .param-row label {
            min-width: 140px;
            font-size: 11px;
        }
        .param-row input[type="number"],
        .param-row input[type="text"] {
            width: 100px;
            padding: 4px 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .param-row input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        .param-row span {
            font-size: 10px;
            color: #888;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        .status {
            font-size: 11px;
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <!-- –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="section">
        <div class="section-title">‚öôÔ∏è –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        <div class="params-grid">
            <div class="param-row">
                <label>ID —Å—Ç–µ–Ω—ã –¥–ª—è –≤—ã—Å–æ—Ç—ã —ç—Ç–∞–∂–∞:</label>
                <input type="text" id="wallIdForFloorHeight" placeholder="–°–ù-–ú–î1">
            </div>
            <div class="param-row">
                <label>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö:</label>
                <input type="checkbox" id="showDuplicateWarning">
            </div>
        </div>
        
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
            <div style="font-weight: bold; margin-bottom: 10px; font-size: 11px; color: #555;">–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á—ë—Ç–∞:</div>
            <div class="params-grid">
                <div class="param-row">
                    <label>–ù–∏–∑ –ø–ª—é—Å –∫ –Ω–∏–∑—É —ç—Ç–∞–∂–∞:</label>
                    <input type="number" id="offsetX" value="165">
                    <span>–º–º</span>
                </div>
                <div class="param-row">
                    <label>–°–º–µ—â–µ–Ω–∏–µ Y:</label>
                    <input type="number" id="offsetY" value="50">
                    <span>–º–º</span>
                </div>
                <div class="param-row">
                    <label>–í–µ—Ä—Ö –ø–ª—é—Å –∫ –≤—ã—Å–æ—Ç–µ —ç—Ç–∞–∂–∞:</label>
                    <input type="number" id="offsetTop" value="745">
                    <span>–º–º</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¢–∏–ø 0 -->
    <div class="section">
        <div class="section-title">üî∑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¢–∏–ø 0</div>
        
        <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 8px; font-size: 11px; color: #555;">–†–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤:</div>
            <div class="params-grid">
                <div class="param-row">
                    <label>–®–∏—Ä–∏–Ω–∞ –ø–ª–∞–Ω–∫–∏:</label>
                    <input type="number" id="type0_plankWidth" value="285">
                    <span>–º–º</span>
                </div>
                <div class="param-row">
                    <label>–®–∏—Ä–∏–Ω–∞ –æ—Ç–∫–æ—Å–∞:</label>
                    <input type="number" id="type0_slopeWidth" value="285">
                    <span>–º–º</span>
                </div>
            </div>
        </div>
        
        <div style="padding-top: 15px; border-top: 1px solid #eee;">
            <div style="font-weight: bold; margin-bottom: 8px; font-size: 11px; color: #555;">ID —Ü–µ–ª–µ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤:</div>
            <div class="params-grid">
                <div class="param-row">
                    <label>ID –ø–ª–∞–Ω–æ–∫:</label>
                    <input type="text" id="type0_plankId" placeholder="OK-0_PLNK">
                </div>
                <div class="param-row">
                    <label>ID –ª–µ–≤—ã—Ö –æ—Ç–∫–æ—Å–æ–≤:</label>
                    <input type="text" id="type0_leftSlopeId" placeholder="OK-0_LOTK">
                </div>
                <div class="param-row">
                    <label>ID –ø—Ä–∞–≤—ã—Ö –æ—Ç–∫–æ—Å–æ–≤:</label>
                    <input type="text" id="type0_rightSlopeId" placeholder="OK-0_ROTK">
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¢–∏–ø—ã 1-2 -->
    <div class="section">
        <div class="section-title">üî∂ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¢–∏–ø—ã 1-2</div>
        
        <div style="margin-bottom: 15px;">
            <div style="font-weight: bold; margin-bottom: 8px; font-size: 11px; color: #555;">–†–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤:</div>
            <div class="params-grid">
                <div class="param-row">
                    <label>–®–∏—Ä–∏–Ω–∞ –ø–ª–∞–Ω–∫–∏:</label>
                    <input type="number" id="type12_plankWidth" value="160">
                    <span>–º–º</span>
                </div>
                <div class="param-row">
                    <label>–®–∏—Ä–∏–Ω–∞ –æ—Ç–∫–æ—Å–∞:</label>
                    <input type="number" id="type12_slopeWidth" value="225">
                    <span>–º–º</span>
                </div>
            </div>
        </div>
        
        <div style="padding-top: 15px; border-top: 1px solid #eee;">
            <div style="font-weight: bold; margin-bottom: 8px; font-size: 11px; color: #555;">ID —Ü–µ–ª–µ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤:</div>
            <div class="params-grid">
                <div class="param-row">
                    <label>ID –∫–∞—Å—Å–µ—Ç:</label>
                    <input type="text" id="type12_cassetteId" placeholder="OK-1_2_CASS">
                </div>
                <div class="param-row">
                    <label>ID –ø–ª–∞–Ω–æ–∫:</label>
                    <input type="text" id="type12_plankId" placeholder="OK-1_2_PLNK">
                </div>
                <div class="param-row">
                    <label>ID –ª–µ–≤—ã—Ö –æ—Ç–∫–æ—Å–æ–≤:</label>
                    <input type="text" id="type12_leftSlopeId" placeholder="OK-1_2_LOTK">
                </div>
                <div class="param-row">
                    <label>ID –ø—Ä–∞–≤—ã—Ö –æ—Ç–∫–æ—Å–æ–≤:</label>
                    <input type="text" id="type12_rightSlopeId" placeholder="OK-1_2_ROTK">
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="buttons">
        <button class="btn btn-primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn btn-secondary" onclick="loadSettings()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        <button class="btn btn-secondary" onclick="resetDefaults()">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
    </div>

    <div id="status"></div>

    <script>
        // –°–æ–±—Ä–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ñ–æ—Ä–º—ã
        function collectSettings() {
            return {
                defaultType: 0,
                wallIdForFloorHeight: document.getElementById('wallIdForFloorHeight').value || '–°–ù-–ú–î1',
                showDuplicateWarning: document.getElementById('showDuplicateWarning').checked,
                
                type0: {
                    plankWidth: parseInt(document.getElementById('type0_plankWidth').value) || 285,
                    slopeWidth: parseInt(document.getElementById('type0_slopeWidth').value) || 285,
                    offsetX: parseInt(document.getElementById('offsetX').value) || 165,
                    offsetY: parseInt(document.getElementById('offsetY').value) || 50,
                    x2Coeff: parseInt(document.getElementById('offsetTop').value) || 745,
                    cassetteId: '',
                    plankId: document.getElementById('type0_plankId').value || 'OK-0_PLNK',
                    leftSlopeId: document.getElementById('type0_leftSlopeId').value || 'OK-0_LOTK',
                    rightSlopeId: document.getElementById('type0_rightSlopeId').value || 'OK-0_ROTK'
                },
                
                type1_2: {
                    plankWidth: parseInt(document.getElementById('type12_plankWidth').value) || 160,
                    slopeWidth: parseInt(document.getElementById('type12_slopeWidth').value) || 225,
                    offsetX: parseInt(document.getElementById('offsetX').value) || 165,
                    offsetY: parseInt(document.getElementById('offsetY').value) || 50,
                    x2Coeff: parseInt(document.getElementById('offsetTop').value) || 745,
                    cassetteId: document.getElementById('type12_cassetteId').value || 'OK-1_2_CASS',
                    plankId: document.getElementById('type12_plankId').value || 'OK-1_2_PLNK',
                    leftSlopeId: document.getElementById('type12_leftSlopeId').value || 'OK-1_2_LOTK',
                    rightSlopeId: document.getElementById('type12_rightSlopeId').value || 'OK-1_2_ROTK'
                }
            };
        }

        // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ —Ñ–æ—Ä–º–µ
        function applySettings(settings) {
            if (!settings) return;
            
            // –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('wallIdForFloorHeight').value = settings.wallIdForFloorHeight || '–°–ù-–ú–î1';
            document.getElementById('showDuplicateWarning').checked = settings.showDuplicateWarning !== false;
            
            // –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á—ë—Ç–∞ (–±–µ—Ä—ë–º –∏–∑ type1_2, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –æ–±—â–∏–µ)
            const offsetX = settings.type1_2?.offsetX || settings.type0?.offsetX || 165;
            const offsetY = settings.type1_2?.offsetY || settings.type0?.offsetY || 50;
            const offsetTop = settings.type1_2?.x2Coeff || settings.type0?.x2Coeff || 745;
            
            document.getElementById('offsetX').value = offsetX;
            document.getElementById('offsetY').value = offsetY;
            document.getElementById('offsetTop').value = offsetTop;
            
            // –¢–∏–ø 0
            if (settings.type0) {
                document.getElementById('type0_plankWidth').value = settings.type0.plankWidth || 285;
                document.getElementById('type0_slopeWidth').value = settings.type0.slopeWidth || 285;
                document.getElementById('type0_plankId').value = settings.type0.plankId || 'OK-0_PLNK';
                document.getElementById('type0_leftSlopeId').value = settings.type0.leftSlopeId || 'OK-0_LOTK';
                document.getElementById('type0_rightSlopeId').value = settings.type0.rightSlopeId || 'OK-0_ROTK';
            }
            
            // –¢–∏–ø—ã 1-2
            if (settings.type1_2) {
                document.getElementById('type12_plankWidth').value = settings.type1_2.plankWidth || 160;
                document.getElementById('type12_slopeWidth').value = settings.type1_2.slopeWidth || 225;
                document.getElementById('type12_cassetteId').value = settings.type1_2.cassetteId || 'OK-1_2_CASS';
                document.getElementById('type12_plankId').value = settings.type1_2.plankId || 'OK-1_2_PLNK';
                document.getElementById('type12_leftSlopeId').value = settings.type1_2.leftSlopeId || 'OK-1_2_LOTK';
                document.getElementById('type12_rightSlopeId').value = settings.type1_2.rightSlopeId || 'OK-1_2_ROTK';
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function getDefaultSettings() {
            return {
                defaultType: 0,
                wallIdForFloorHeight: '–°–ù-–ú–î1',
                showDuplicateWarning: true,
                type0: {
                    plankWidth: 285,
                    slopeWidth: 285,
                    offsetX: 165,
                    offsetY: 50,
                    x2Coeff: 745,
                    cassetteId: '',
                    plankId: 'OK-0_PLNK',
                    leftSlopeId: 'OK-0_LOTK',
                    rightSlopeId: 'OK-0_ROTK'
                },
                type1_2: {
                    plankWidth: 160,
                    slopeWidth: 225,
                    offsetX: 165,
                    offsetY: 50,
                    x2Coeff: 745,
                    cassetteId: 'OK-1_2_CASS',
                    plankId: 'OK-1_2_PLNK',
                    leftSlopeId: 'OK-1_2_LOTK',
                    rightSlopeId: 'OK-1_2_ROTK'
                }
            };
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
            setTimeout(() => { status.className = ''; status.textContent = ''; }, 3000);
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        async function saveSettings() {
            const settings = collectSettings();
            try {
                // TODO: –í—ã–∑–≤–∞—Ç—å SaveCassetteSettings —á–µ—Ä–µ–∑ ACAPI
                // await window.ACAPI.SaveCassetteSettings(settings);
                
                // –ü–æ–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('cassetteSettings', JSON.stringify(settings));
                showStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            } catch (e) {
                showStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e, true);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        async function loadSettings() {
            try {
                // TODO: –í—ã–∑–≤–∞—Ç—å GetCassetteSettings —á–µ—Ä–µ–∑ ACAPI
                // const settings = await window.ACAPI.GetCassetteSettings();
                
                // –ü–æ–∫–∞ –∏–∑ localStorage
                const stored = localStorage.getItem('cassetteSettings');
                const settings = stored ? JSON.parse(stored) : getDefaultSettings();
                applySettings(settings);
                showStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            } catch (e) {
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e, true);
            }
        }

        // –°–±—Ä–æ—Å–∏—Ç—å –∫ defaults
        function resetDefaults() {
            applySettings(getDefaultSettings());
            showStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã');
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>
